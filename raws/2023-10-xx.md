# Python in Excel

*A couple of initial thoughts after trying Python in MS Excel.*

About a month ago [Microsoft announced Python in Excel](https://techcommunity.microsoft.com/t5/excel-blog/announcing-python-in-excel-combining-the-power-of-python-and-the/ba-p/3893439) for users running Beta Channel on Windows, with plans to eventually include this capability in everyone's setup down the road. My main takeaways from this article are:

* Python code can be inserted in cells instead of Excel formulas, and the result is shown in the worksheet.
* An `xl()` function can be used to access cell data in the Python code.
* The Python code is executed in the [Microsoft Cloud](https://www.microsoft.com/en/microsoft-cloud), not on your computer, so custom packages likely cannot be installed.
* The MS Cloud setup uses [Anaconda](https://www.anaconda.com/). As stated by Microsoft in [their announcement](https://techcommunity.microsoft.com/t5/excel-blog/announcing-python-in-excel-combining-the-power-of-python-and-the/ba-p/3893439): *Excel users now have access to powerful analytics via Python for visualizations, cleaning data, machine learning, predictive analytics, and more.*
* Some of the included packages: [Matplotlib](https://matplotlib.org/), [Seaborn](https://seaborn.pydata.org/), [scikit-learn](https://scikit-learn.org/stable/index.html), [statsmodel](https://www.statsmodels.org/stable/index.html), [pandas](https://pandas.pydata.org/), [numpy](https://numpy.org/) and many more.
* From the [Microsoft announcement](https://techcommunity.microsoft.com/t5/excel-blog/announcing-python-in-excel-combining-the-power-of-python-and-the/ba-p/3893439): *While in Preview, Python in Excel will be included with your Microsoft 365 subscription. After the Preview, some functionality will be restricted without a paid license.*

<br />

While I'd love to see this feature as being *free* (included in everyone's Excel), this is definitely great news for any Python enthousiast.

> Present the following subsections.

## Complex numbers

Excel's handling of complex numbers has long irritated me; not only do you need to use a `COMPLEX` function to define complex numbers, you also need functions to compute basic operations such as additions. This is so impractical that electrical quantities are often linearized in Excel for simplicity. While this may not be a problem for a given problem, it is nonetheless frustrating.

Here's a simple complex number addition using traditional Excel functions (in French, but the same principle applies to English; `SOMME` = `SUM`):

![img](media/2023-09-28_Excel_Complex.png)

This equation of complex numbers could hardly be simpler, but it is already barely readable. This also implies that one has to *know* beforehand if the input variables (ex.: from other cells) might be a complex number and take appropriate measures when developing formulas accessing those input variables.

No function, special step or consideration has to be taken with Python:

![img](media/2023-09-28_Python_Complex.png)

While it's annoying that it shows a `complex` object instead of the value, the formula itself is much more readable and complex mathematical operations can more easily be understood.

## Comments and variables

> Show an example using comments and variable assignment in Python.

## Project deliverable

A few years ago my colleagues and myself have made the decision of using [Jupyter Notebooks](https://jupyter.org/) instead of Excel spreadsheets to prepare calculation notes for our projects, for 2 key reasons:

* **Efficiency:**
  * To prepare professional deliverables with a spreadsheet based calculation, we usually resorted to presenting the methodology and output in an MS Word document. This involved copying and pasting parts of the spreadsheet manually, usually repeatedly as calculations were revised (which is normal in the projects' lifecycle).
  * This is no longer necessary because [Jupyter Notebooks can easily be formatted professionally by using LaTeX and Markdown](https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Working%20With%20Markdown%20Cells.html).
* **Quality:**
  * By eliminating the copy / paste process between the spreadsheet and the deliverable, a major source of error was nullified.
  * In a spreadsheet, formulas are hidden when the document is viewed and printed (unless a cell is selected). Controlling the quality of the logic must therefore be done with the original spreadsheet, not its output (ex.: PDF).
  * The order of execution can be chaotic in a spreadsheet, especially as complexity increases. We have had to build flowcharts to explain in which order big Excel files had to be used; it's obvious in notebooks (from top to bottom).

<br />

Python in Excel doesn't change that; I'd argue it could make the problem worse by adding complexity for non-Python people, and encouraging more code hidden in cell formulas. Nonetheless, spreadsheets are not going away and Python could be extremely useful.

## The dreaded VBA

I generally consider advanced Excel users as those being able to handle [XLOOKUP with multiple criteria](https://exceljet.net/formulas/xlookup-with-multiple-criteria), and power users are those able to handle [Power Query](https://support.microsoft.com/en-gb/office/about-power-query-in-excel-7104fbee-9e62-4cb9-a02e-5bfb1a6c536a) and develop [Excel VBA](https://learn.microsoft.com/en-us/office/vba/api/overview/excel).

As shown in [Stack Overflow's 2021 survey](https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread), VBA is one of the most dreaded programming languages. It is rather unavoidable when developping MS Excel spreadsheets beyond a certain complexity, and a Python alternative would be more than welcome.

There are several ways to use Python in combination with Excel but one officially supported by Microsoft would significantly help broad enterprise adoption. In addition, younger employees are increasingly entering the workplace with basic Python skills.

## Closing thoughts

> Needed!
